<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data noupdate="0">

    <record id="view_timesheet_period_list" model="ir.ui.view">
    <field name="name">timesheet.period.list</field>
    <field name="model">timesheet.period</field>
    <field name="arch" type="xml">
        <list string="Timesheet Periods">
            <field name="name"/>
            <field name="date_start"/>
            <field name="date_end"/>
            <field name="company_id"/>
            <field name="state"/>
        </list>
    </field>
    </record>

    <!-- VISTA FORM: mejora la creación/edición -->
    <record id="view_timesheet_period_form" model="ir.ui.view">
    <field name="name">timesheet.period.form</field>
    <field name="model">timesheet.period</field>
    <field name="arch" type="xml">
        <form string="Timesheet Period">
        <header>
            <field name="state" widget="statusbar" statusbar_visible="open,closed"/>
        </header>
        <sheet>
            <group>
                <field name="name" placeholder="Ej. Corte Ago-2025"/>            
            </group>
            <group>
                <separator string="Datos del período" colspan="4"/>
                <field name="date_start" required="1"/>
                <field name="date_end" required="1"/>
                <field name="company_id" options="{'no_create': True}"/>
                <field name="employee_id"/>
            </group>

            <notebook>            
            <page string="Timesheets">
                <separator string="Hoja Tiempo Mensual" colspan="4"/>
                <field name="timesheet_line_ids">
                <list editable="bottom">
                    <!-- Ajusta columnas según tus campos reales en account.analytic.line -->
                    <field name="date"/>
                    <field name="employee_id"/>
                    <field name="linea_negocio"/>

                    <field name="project_id" string="Centro_Costo"/>                                    
                    <field name="name"/>
                    
                    <field name="x_account_kind" optional="show"/>
                    <field name="x_percent" optional="show"/>
                </list>
                </field>
            </page>
            </notebook>
        </sheet>
        </form>
    </field>
    </record>

    <!-- KANBAN -->
    <record id="view_timesheet_period_kanban" model="ir.ui.view">
    <field name="name">timesheet.period.kanban</field>
    <field name="model">timesheet.period</field>
    <field name="arch" type="xml">
        <kanban
        default_group_by="state"
        class="o_kanban_small_column"
        create="1"
        quick_create="1"
        quick_create_view="true">
        
        <!-- Encabezado de columna (agrupación por state) -->
        <templates>
            <t t-name="kanban-box">
            <div class="oe_kanban_global_click o_kanban_record">
                <!-- Cabecera: nombre y estado como etiqueta -->
                <div class="o_kanban_header d-flex justify-between align-center">
                <strong t-esc="record.name.value"/>
                <span t-att-class="'badge ' + (record.state.raw_value === 'closed' ? 'text-bg-secondary' : 'text-bg-success')">
                    <t t-esc="record.state.value"/>
                </span>
                </div>

                <!-- Cuerpo: fechas y compañía -->
                <div class="o_kanban_body mt-2">
                <div>
                    <i class="fa fa-calendar"/> 
                    <t t-esc="record.date_start.value"/> → <t t-esc="record.date_end.value"/>
                </div>
                <div t-if="record.company_id.value">
                    <i class="fa fa-building"/> <t t-esc="record.company_id.value"/>
                </div>
                </div>

                <!-- Footer: acciones rápidas -->
                <div class="o_kanban_footer d-flex gap-2 mt-2">
                <a type="edit" class="btn btn-link p-0"><i class="fa fa-pencil"/></a>
                <a type="open" class="btn btn-link p-0"><i class="fa fa-external-link"/></a>
                <!-- Dropdown de acciones (opcional) -->
                <div class="dropdown ms-auto">
                    <button class="btn btn-link p-0 dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fa fa-ellipsis-v"/>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <a type="action" name="action_set_open" class="dropdown-item" t-if="record.state.raw_value === 'closed'">
                        Reabrir período
                        </a>
                    </li>
                    <li>
                        <a type="action" name="action_set_closed" class="dropdown-item" t-if="record.state.raw_value === 'open'">
                        Cerrar período
                        </a>
                    </li>
                    </ul>
                </div>
                </div>
            </div>
            </t>
        </templates>

        <!-- Etiqueta de columna -->
        <column>
            <field name="state"/>
        </column>

        <!-- Campos usados en la plantilla -->
        <field name="name"/>
        <field name="date_start"/>
        <field name="date_end"/>
        <field name="company_id"/>
        <field name="state"/>
        </kanban>
    </field>
    </record>


    <record id="action_timesheet_period" model="ir.actions.act_window">
        <field name="name">Timesheet Periods</field>
        <field name="res_model">timesheet.period</field>
        <field name="view_mode">kanban,list,form</field>
    </record>

    <menuitem
        id="menu_timesheet_period"
        name="P. Hoja Tiempo"
        parent="hr_timesheet.timesheet_menu_root"
        action="action_timesheet_period"
        sequence="20"/>


  </data>
</odoo>
